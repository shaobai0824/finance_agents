# 鉅亨網財經新聞爬蟲使用說明

## 概述
此系統提供真實的鉅亨網財經新聞爬取功能，能夠從 cnyes.com 爬取最新的財經新聞並整合到向量資料庫中，供理財專家 agents 使用。

## 主要功能
1. **真實新聞爬取**：從鉅亨網爬取實際的財經新聞內容
2. **多分類支援**：支援台股、美股、基金、理財、外匯、國際等分類
3. **JSON格式輸出**：結構化儲存爬取的新聞資料
4. **向量資料庫整合**：自動載入到ChromaDB向量資料庫
5. **智能標籤系統**：基於內容自動生成相關標籤

## 檔案結構
```
├── real_cnyes_scraper.py          # 真實新聞爬蟲主程序
├── integrate_real_cnyes_data.py   # 向量資料庫整合程序
├── data/                          # 爬取資料儲存目錄
│   └── real_cnyes_news_*.json    # 爬取的新聞JSON檔案
└── README_CNYES_SCRAPER.md       # 本說明文檔
```

## 使用方式

### 步驟 1：安裝依賴套件
```bash
pip install requests beautifulsoup4 lxml
```

### 步驟 2：執行真實新聞爬蟲
```bash
python real_cnyes_scraper.py
```

**功能說明**：
- 自動爬取鉅亨網6個主要分類的最新新聞
- 每個分類預設爬取3篇文章（可調整）
- 自動儲存為JSON格式到 `data/` 目錄
- 包含完整的新聞標題、內容、URL、分類、時間等資訊

**輸出範例**：
```
真實鉅亨網新聞爬蟲
==================================================

開始爬取 台股 分類...
正在爬取 台股 分類: https://news.cnyes.com/news/cat/tw_stock
找到 3 個新聞連結
正在處理第 1/3 篇新聞...
成功爬取: 小米台灣同步發表15T系列手機及9款AIoT新品...

爬取完成！
總共爬取: 15 篇新聞
JSON檔案: data/real_cnyes_news_20250927_132114.json
```

### 步驟 3：整合到向量資料庫
```bash
python integrate_real_cnyes_data.py
```

**功能說明**：
- 自動載入最新的JSON檔案
- 轉換為向量資料庫格式
- 生成智能標籤（如：台積電、小米、TikTok、輝達等）
- 載入到ChromaDB向量資料庫
- 提供檢索功能測試

**輸出範例**：
```
整合真實鉅亨網資料到向量資料庫
==================================================
使用資料檔案: data/real_cnyes_news_20250927_132114.json

[1] 載入真實鉅亨網資料...
載入 15 篇新聞

[2] 轉換為向量資料庫格式...
轉換完成，共 15 篇文檔

[3] 載入到向量資料庫...
真實新聞載入完成！總共 15 篇

[4] 測試檢索功能...
查詢: 小米新產品發表
找到 2 個相關結果:
  1. 小米台灣同步發表15T系列手機及9款AIoT新品...
```

## JSON資料格式

爬取的資料會儲存為以下JSON格式：

```json
{
  "metadata": {
    "source": "cnyes.com",
    "scrape_time": "2025-09-27T13:21:14.501841",
    "total_articles": 15,
    "categories": ["台股", "美股", "基金", "外匯", "國際"],
    "scraper": "RealCnyesScraper"
  },
  "articles": [
    {
      "title": "小米台灣同步發表15T系列手機及9款AIoT新品",
      "content": "台股台股新聞...完整新聞內容...",
      "url": "https://news.cnyes.com/news/id/6169813",
      "category": "台股",
      "publish_time": "--",
      "scrape_time": "2025-09-27T13:20:14.776666",
      "source": "cnyes.com"
    }
  ]
}
```

## 支援的新聞分類

| 分類 | 網址 | 說明 |
|------|------|------|
| 台股 | https://news.cnyes.com/news/cat/tw_stock | 台灣股市相關新聞 |
| 美股 | https://news.cnyes.com/news/cat/us_stock | 美國股市相關新聞 |
| 基金 | https://news.cnyes.com/news/cat/fund | 基金投資相關新聞 |
| 理財 | https://news.cnyes.com/news/cat/wealth | 個人理財規劃新聞 |
| 外匯 | https://news.cnyes.com/news/cat/forex | 外匯市場相關新聞 |
| 國際 | https://news.cnyes.com/news/cat/wd_stock | 國際財經相關新聞 |

## 智能標籤系統

系統會根據新聞內容自動生成相關標籤：

- **公司標籤**：台積電、小米、TikTok、輝達、英特爾
- **政策標籤**：聯準會、川普、降息
- **市場標籤**：美股、台股、基金、投資、AI

## 技術特點

1. **反反爬機制**：使用適當的請求間隔和User-Agent
2. **容錯處理**：自動處理網路錯誤和解析失敗
3. **內容清理**：移除廣告和無關內容
4. **編碼處理**：正確處理中文字符和特殊符號
5. **增量更新**：支援載入新資料而不影響現有資料

## 整合理財專家系統

爬取的新聞會自動整合到理財專家agents系統中：

1. **金融分析專家**：利用最新市場資訊進行分析
2. **理財規劃專家**：結合個人財務狀況提供建議
3. **RAG檢索**：支援自然語言查詢相關新聞

## 注意事項

1. **遵守網站條款**：請遵守鉅亨網的使用條款
2. **適當頻率**：避免過於頻繁的請求
3. **資料準確性**：建議定期更新以獲取最新資訊
4. **儲存空間**：JSON檔案會逐漸累積，注意管理儲存空間

## 疑難排解

### 常見問題

**Q: 爬取失敗或找不到新聞**
A: 檢查網路連線，確認鉅亨網網站是否正常運作

**Q: JSON檔案過大**
A: 可調整 `max_articles_per_category` 參數限制每分類的文章數量

**Q: 向量資料庫載入失敗**
A: 確認ChromaDB正常運作，檢查資料格式是否正確

### 自訂設定

可在 `real_cnyes_scraper.py` 中調整以下參數：

```python
# 調整每分類爬取的文章數量
articles = scraper.scrape_all_categories(max_articles_per_category=5)

# 調整請求間隔
time.sleep(3)  # 分類間間隔
time.sleep(2)  # 文章間間隔
```

## 更新日誌

- **2025-09-27**：初版發布，支援真實新聞爬取和向量資料庫整合